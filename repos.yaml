version: 3
repos:
  - id: /.*/
    workflow: custom

workflows:
  custom:
    plan:
      steps:
        - run: terraform init
        - run: terraform plan -out=tfplan
    apply:
      steps:
        - run: terraform apply tfplan
        - run: ansible-playbook -i ansible/inventory.yml ansible/playbook.yml
